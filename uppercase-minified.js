var cancel=!1;function waitUntilLoaded(e){setTimeout((()=>{document.querySelector(".loading-container")?waitUntilLoaded(e):e()}),100)}function onEscape(e){"Escape"===e.code&&(cancel=!0)}function isTranslationPage(){return window.location.href.startsWith("https://www.bilibilicomics.com/tracer/#/translate-editor")}function getDialogRejectButton(e,{delay:t=500}={}){const n=document.querySelector(".p-dialog-footer .p-button.p-confirm-dialog-reject");return!n&&t>0&&setTimeout((()=>{getDialogRejectButton(e,{delay:t-100})}),100),e(n)}function waitUntilCancel(e){getDialogRejectButton((t=>{t&&t.click(),waitUntilLoaded(e)}))}function run(){const e=prompt("Start from","1");if(null==e)return;const t=prompt("Stop at",`${getImageCards().length}`);if(null==t)return;const n=parseInt(e),o=parseInt(t);if(isNaN(n)||isNaN(o))return alert("Please enter only numbers."),void run();if(n>o)return alert("Stop page cannot come before start page number"),void run();const a=document.querySelectorAll(".image-card");if(0===a.length)return void alert("Please refresh the page.");const i=a[Math.max(0,n-1)];i.classList.contains("actived")?go({stop:o}):(i.click(),waitUntilCancel((()=>{window.removeEventListener("keydown",onEscape),window.addEventListener("keydown",onEscape,!0),go({stop:o})})))}function getContainer(e){const t=document.querySelector(".operation-content");t?e(t):setTimeout((()=>{getContainer(e)}),100)}function addButton(){if(document.querySelector('div[data-name="gm-uppercase"]'))return;const e=document.createElement("div");e.innerHTML="Aa",e.dataset.name="gm-uppercase",e.style.width="40px",e.style.height="40px",e.style.display="flex",e.style.flexFlow="row nowrap",e.style.alignItems="center",e.style.justifyContent="center",e.style.cursor="pointer",e.style.order=1,e.classList.add("editor-button"),e.classList.add("p-ripple"),e.addEventListener("click",(e=>{confirm("Do you want to capitalize translations? ⚠️ Any unsaved changes will be lost.")&&run()})),getContainer((t=>{t.prepend(e)}))}function main(){isTranslationPage()&&addButton()}function getActiveIndex(e){const t=getImageCards().findIndex((e=>e.classList.contains("actived")));if(-1!==t)return e(t);setTimeout((()=>{getActiveIndex(e)}),100)}function getImageCards(){return Array.from(document.querySelectorAll(".image-card"))}function next(e){document.querySelector(".bottom-action").childNodes[1].childNodes[2].click(),waitUntilLoaded(e)}function save(){document.querySelector(".bottom-action").childNodes[0].click()}function hasMore(){const e=getImageCards();return e.length>0&&!e[e.length-1].classList.contains("actived")}function uppercase(e){Array.from(document.querySelectorAll(".target-input")).forEach((e=>{""!=e.value&&(e.value=e.value.toUpperCase(),e.dispatchEvent(new Event("input",{bubbles:!0})))})),save(),waitUntilLoaded(e)}function done(){alert("Done.")}function go({stop:e}={}){getActiveIndex((t=>{uppercase((()=>{null!=e&&t>=e-1?done():next((()=>{if(cancel)return done(),void(cancel=!1);hasMore()?go({stop:e}):uppercase(done)}))}))}))}main();
